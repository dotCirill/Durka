!!! Где
    Вирт, структуры данных 1989.

    Смотри 287 страницу.

    [Какой-то сайт, вроде $\pm$ как на лекциях](https://vikidalka.ru/2-117065.html)

    [Ютубек](https://www.youtube.com/watch?v=hgA4xxlVvfQ)
    
    [Ещё один](https://www.youtube.com/watch?v=Shrk9Y0dEdY)

## Зачем

Бывают случаи, когда информация о вероятности появления ключа известна. В таких ситуациях характерно постоянство ключей, то есть ключи не добавляются, не удаляются, и сохраняется структура дерева. И для сокращения времени необходимо использование таких деревьев, в которых самые часто встречающиеся вершины находились бы ближе к корню дерева.

Изменилась метрика того, на сколько дерево хорошее -- раньше была средняя длина пути, теперь средне-взвешенная длина пути. Сумма всех вершин от корня, умноженная на вероятность.

Пример: $p_1 = \frac{1}{7}$, $p_2 = \frac{2}{7}$, $p_3 = \frac{4}{7}$. Самое оптимальное -- дерево (а), у него средре-взвешенная длина пути: $\frac{4\cdot 1}{7} + \frac{2\cdot 2}{7} + \frac{1\cdot 3}{7} = \frac{11}{7}$
![Деревья (Вирт рис.4.36)](Оптимального поиска/деревья.svg "Деревья (Вирт рис.4.36)")


## Основные положения

!!! error
    Написаное здесь -- отвратительно, если ничего не понятно -- всё хорошо, мы тоже не понимаем..

    Поставим сюда большой-большой **TODO**.


$a_i$ -- число поисков вершины $k_i$. 

$b_i$ -- число поисков псевдовершины $x$, $\ k_i < x < k_{i+1}$

1. Псевдовершины -- некоторые поиски заканчиваем неудачно, создаем псевдовершины в квадратах.
2. Отойдем от вероятности -- считаем число поисков.
3. Длина средневзвешенного пути  $S = \sum_{i=1}^{n}a_ih_i + \sum_{j=1}^{m}b_jh'_j$.

**Основное свойство**: любое поддерево дерева оптимального поиска так же оптимально. То есть если дерево оптимального поиска разделим пополам относительно вершины, то левое и правое поддерево по этому свойству будут также оптимальными.

Так что фигачим снизу вверх, начиная с одной вершины. При добавлении $n+1$ элемента (в дерево из элементов) получаем $n+1$ различных вариантов. 

$S = \ldots \text{доказательство TODO}\ldots= S_{left} + S_{right} + W$, где

$W$ -- вес дерева оптимального поиска
## Построение дерева

1. Построение таблицы весов $W_{ii}$ -- вес дерева $T_{ii}$ (дерево с ключами $k_i \ldots k_{i+1}$)
2. Достраиваем таблицу $W_{ij} = W_{ij - 1} + a_ib_j$
3. Таблица путей $S_{ii} = W_{ii}$
4. $S_{ij} = W_{ij-1} + \min_{i<k\leq j} (S_{ik - 1} + S_{kj})$

Сложность построения -- $O(n^3)$, в Вирте оптимизируется до $O(n^2)$, а так же есть штуки с эвристиками (результат не всегда идельный) со сложностью $O(n)$.